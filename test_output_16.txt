
> task-manager-backend@1.0.0 test
> jest tests/unit/admin.service.test.js

  console.log
    [dotenv@17.2.3] injecting env (22) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

node.exe : FAIL 
tests/unit/admin.service.test.js
At C:\Program Files\nodejs\npm.ps1:29 char:3
+   & $NODE_EXE $NPM_CLI_JS $args
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified:  
   (FAIL tests/unit/admin.service.test.js:S  
  tring) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandE 
   rror
 
  AdminService
    login
      ΓêÜ should successfully login with 
valid credentials (21 ms)
      ├ù should throw error for invalid 
credentials (3 ms)
      ├ù should throw error for non-existent 
admin (2 ms)
      ├ù should lock account after 5 failed 
attempts (2 ms)
      ΓêÜ should handle remember me option 
correctly (3 ms)
    refreshToken
      ΓêÜ should refresh tokens with valid 
refresh token (5 ms)
      ├ù should throw error for invalid 
refresh token (3 ms)
      ├ù should throw error for expired 
refresh token (3 ms)
      ├ù should throw error for token 
version mismatch (2 ms)
      ├ù should throw error for locked 
account (2 ms)
      ΓêÜ should increment token version on 
refresh (4 ms)
    updateProfile
      ├ù should update admin profile 
successfully (2 ms)
      ├ù should throw error for duplicate 
email
      ├ù should allow same email for same 
admin
    forgotPassword
      ΓêÜ should generate and send OTP for 
valid admin (1 ms)
      ├ù should throw error for non-existent 
admin (1 ms)
      ├ù should handle locked account

  ΓùÅ AdminService ΓÇ║ login ΓÇ║ should 
throw error for invalid credentials

    expect(received).toContain(expected) // 
indexOf

    Expected substring: "INVALID_ADMIN_AUTH"
    Received string:    "The email or 
password provided is incorrect."

    [0m [90m 279 |[39m       expect(error)
[33m.[39mtoBeInstanceOf(expectedErrorClass)
[33m;[39m
     [90m 280 |[39m       [36mif[39m 
(expectedMessage) {
    [31m[1m>[22m[39m[90m 281 |[39m     
    expect(error[33m.[39mmessage)[33m.[39
mtoContain(expectedMessage)[33m;[39m
     [90m     |[39m                        
       [31m[1m^[22m[39m
     [90m 282 |[39m       }
     [90m 283 |[39m     }
     [90m 284 |[39m   }[0m

      at Function.toContain [as 
expectAsyncError] 
(tests/setup/test-setup.js:281:31)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:103:7)

  ΓùÅ AdminService ΓÇ║ login ΓÇ║ should 
throw error for non-existent admin

    expect(received).toContain(expected) // 
indexOf

    Expected substring: "INVALID_ADMIN_AUTH"
    Received string:    "The email or 
password provided is incorrect."

    [0m [90m 279 |[39m       expect(error)
[33m.[39mtoBeInstanceOf(expectedErrorClass)
[33m;[39m
     [90m 280 |[39m       [36mif[39m 
(expectedMessage) {
    [31m[1m>[22m[39m[90m 281 |[39m     
    expect(error[33m.[39mmessage)[33m.[39
mtoContain(expectedMessage)[33m;[39m
     [90m     |[39m                        
       [31m[1m^[22m[39m
     [90m 282 |[39m       }
     [90m 283 |[39m     }
     [90m 284 |[39m   }[0m

      at Function.toContain [as 
expectAsyncError] 
(tests/setup/test-setup.js:281:31)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:115:7)

  ΓùÅ AdminService ΓÇ║ login ΓÇ║ should lock 
account after 5 failed attempts

    expect(received).toContain(expected) // 
indexOf

    Expected substring: "ACCOUNT_LOCKED"
    Received string:    "Too many failed 
attempts. Account locked for 15 minutes."

    [0m [90m 279 |[39m       expect(error)
[33m.[39mtoBeInstanceOf(expectedErrorClass)
[33m;[39m
     [90m 280 |[39m       [36mif[39m 
(expectedMessage) {
    [31m[1m>[22m[39m[90m 281 |[39m     
    expect(error[33m.[39mmessage)[33m.[39
mtoContain(expectedMessage)[33m;[39m
     [90m     |[39m                        
       [31m[1m^[22m[39m
     [90m 282 |[39m       }
     [90m 283 |[39m     }
     [90m 284 |[39m   }[0m

      at Function.toContain [as 
expectAsyncError] 
(tests/setup/test-setup.js:281:31)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:134:7)

  ΓùÅ AdminService ΓÇ║ refreshToken ΓÇ║ 
should throw error for invalid refresh token

    expect(received).toContain(expected) // 
indexOf

    Expected substring: "INVALID_TOKEN"
    Received string:    "Invalid refresh 
token"

    [0m [90m 279 |[39m       expect(error)
[33m.[39mtoBeInstanceOf(expectedErrorClass)
[33m;[39m
     [90m 280 |[39m       [36mif[39m 
(expectedMessage) {
    [31m[1m>[22m[39m[90m 281 |[39m     
    expect(error[33m.[39mmessage)[33m.[39
mtoContain(expectedMessage)[33m;[39m
     [90m     |[39m                        
       [31m[1m^[22m[39m
     [90m 282 |[39m       }
     [90m 283 |[39m     }
     [90m 284 |[39m   }[0m

      at Function.toContain [as 
expectAsyncError] 
(tests/setup/test-setup.js:281:31)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:209:7)

  ΓùÅ AdminService ΓÇ║ refreshToken ΓÇ║ 
should throw error for expired refresh token

    expect(received).toContain(expected) // 
indexOf

    Expected substring: "TOKEN_EXPIRED"
    Received string:    "Refresh token 
expired. Please login again."

    [0m [90m 279 |[39m       expect(error)
[33m.[39mtoBeInstanceOf(expectedErrorClass)
[33m;[39m
     [90m 280 |[39m       [36mif[39m 
(expectedMessage) {
    [31m[1m>[22m[39m[90m 281 |[39m     
    expect(error[33m.[39mmessage)[33m.[39
mtoContain(expectedMessage)[33m;[39m
     [90m     |[39m                        
       [31m[1m^[22m[39m
     [90m 282 |[39m       }
     [90m 283 |[39m     }
     [90m 284 |[39m   }[0m

      at Function.toContain [as 
expectAsyncError] 
(tests/setup/test-setup.js:281:31)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:225:7)

  ΓùÅ AdminService ΓÇ║ refreshToken ΓÇ║ 
should throw error for token version mismatch

    expect(received).toContain(expected) // 
indexOf

    Expected substring: 
"TOKEN_VERSION_MISMATCH"
    Received string:    "Invalid refresh 
token version"

    [0m [90m 279 |[39m       expect(error)
[33m.[39mtoBeInstanceOf(expectedErrorClass)
[33m;[39m
     [90m 280 |[39m       [36mif[39m 
(expectedMessage) {
    [31m[1m>[22m[39m[90m 281 |[39m     
    expect(error[33m.[39mmessage)[33m.[39
mtoContain(expectedMessage)[33m;[39m
     [90m     |[39m                        
       [31m[1m^[22m[39m
     [90m 282 |[39m       }
     [90m 283 |[39m     }
     [90m 284 |[39m   }[0m

      at Function.toContain [as 
expectAsyncError] 
(tests/setup/test-setup.js:281:31)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:241:7)

  ΓùÅ AdminService ΓÇ║ refreshToken ΓÇ║ 
should throw error for locked account

    expect(received).toContain(expected) // 
indexOf

    Expected substring: "ACCOUNT_LOCKED"
    Received string:    "Account is locked"

    [0m [90m 279 |[39m       expect(error)
[33m.[39mtoBeInstanceOf(expectedErrorClass)
[33m;[39m
     [90m 280 |[39m       [36mif[39m 
(expectedMessage) {
    [31m[1m>[22m[39m[90m 281 |[39m     
    expect(error[33m.[39mmessage)[33m.[39
mtoContain(expectedMessage)[33m;[39m
     [90m     |[39m                        
       [31m[1m^[22m[39m
     [90m 282 |[39m       }
     [90m 283 |[39m     }
     [90m 284 |[39m   }[0m

      at Function.toContain [as 
expectAsyncError] 
(tests/setup/test-setup.js:281:31)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:263:7)

  ΓùÅ AdminService ΓÇ║ updateProfile ΓÇ║ 
should update admin profile successfully

    TypeError: Cannot read properties of 
undefined (reading 'error')

    [0m [90m 48 |[39m       
[33mLogger[39m[33m.[39minfo([32m`Cache 
Invalidated: ${key}`[39m)[33m;[39m
     [90m 49 |[39m     } [36mcatch[39m 
(error) {
    [31m[1m>[22m[39m[90m 50 |[39m      
 
[33mLogger[39m[33m.[39merror([32m`Cache 
Delete Error: ${key}`[39m[33m,[39m { 
error[33m:[39m error[33m.[39mmessage 
})[33m;[39m
     [90m    |[39m              
[31m[1m^[22m[39m
     [90m 51 |[39m     }
     [90m 52 |[39m   }
     [90m 53 |[39m[0m

      at Cache.error [as del] 
(src/utils/cache.js:50:14)
      at AdminService.del [as 
invalidateAdminCache] 
(src/services/admin.service.js:45:17)
      at AdminService.invalidateAdminCache 
[as updateProfile] 
(src/services/admin.service.js:349:16)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:299:22)

  ΓùÅ AdminService ΓÇ║ updateProfile ΓÇ║ 
should throw error for duplicate email

    expect(received).toContain(expected) // 
indexOf

    Expected substring: "EMAIL_EXISTS"
    Received string:    "Email already in 
use by another admin"

    [0m [90m 279 |[39m       expect(error)
[33m.[39mtoBeInstanceOf(expectedErrorClass)
[33m;[39m
     [90m 280 |[39m       [36mif[39m 
(expectedMessage) {
    [31m[1m>[22m[39m[90m 281 |[39m     
    expect(error[33m.[39mmessage)[33m.[39
mtoContain(expectedMessage)[33m;[39m
     [90m     |[39m                        
       [31m[1m^[22m[39m
     [90m 282 |[39m       }
     [90m 283 |[39m     }
     [90m 284 |[39m   }[0m

      at Function.toContain [as 
expectAsyncError] 
(tests/setup/test-setup.js:281:31)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:315:7)

  ΓùÅ AdminService ΓÇ║ updateProfile ΓÇ║ 
should allow same email for same admin

    TypeError: Cannot read properties of 
undefined (reading 'error')

    [0m [90m 48 |[39m       
[33mLogger[39m[33m.[39minfo([32m`Cache 
Invalidated: ${key}`[39m)[33m;[39m
     [90m 49 |[39m     } [36mcatch[39m 
(error) {
    [31m[1m>[22m[39m[90m 50 |[39m      
 
[33mLogger[39m[33m.[39merror([32m`Cache 
Delete Error: ${key}`[39m[33m,[39m { 
error[33m:[39m error[33m.[39mmessage 
})[33m;[39m
     [90m    |[39m              
[31m[1m^[22m[39m
     [90m 51 |[39m     }
     [90m 52 |[39m   }
     [90m 53 |[39m[0m

      at Cache.error [as del] 
(src/utils/cache.js:50:14)
      at AdminService.del [as 
invalidateAdminCache] 
(src/services/admin.service.js:45:17)
      at AdminService.invalidateAdminCache 
[as updateProfile] 
(src/services/admin.service.js:349:16)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:331:22)

  ΓùÅ AdminService ΓÇ║ forgotPassword ΓÇ║ 
should throw error for non-existent admin

    expect(received).toContain(expected) // 
indexOf

    Expected substring: "ADMIN_NOT_FOUND"
    Received string:    "Admin with this 
email not found"

    [0m [90m 279 |[39m       expect(error)
[33m.[39mtoBeInstanceOf(expectedErrorClass)
[33m;[39m
     [90m 280 |[39m       [36mif[39m 
(expectedMessage) {
    [31m[1m>[22m[39m[90m 281 |[39m     
    expect(error[33m.[39mmessage)[33m.[39
mtoContain(expectedMessage)[33m;[39m
     [90m     |[39m                        
       [31m[1m^[22m[39m
     [90m 282 |[39m       }
     [90m 283 |[39m     }
     [90m 284 |[39m   }[0m

      at Function.toContain [as 
expectAsyncError] 
(tests/setup/test-setup.js:281:31)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:364:7)

  ΓùÅ AdminService ΓÇ║ forgotPassword ΓÇ║ 
should handle locked account

    expect(received).toContain(expected) // 
indexOf

    Expected substring: "ACCOUNT_LOCKED"
    Received string:    "Account is 
temporarily locked. Please try again later."

    [0m [90m 279 |[39m       expect(error)
[33m.[39mtoBeInstanceOf(expectedErrorClass)
[33m;[39m
     [90m 280 |[39m       [36mif[39m 
(expectedMessage) {
    [31m[1m>[22m[39m[90m 281 |[39m     
    expect(error[33m.[39mmessage)[33m.[39
mtoContain(expectedMessage)[33m;[39m
     [90m     |[39m                        
       [31m[1m^[22m[39m
     [90m 282 |[39m       }
     [90m 283 |[39m     }
     [90m 284 |[39m   }[0m

      at Function.toContain [as 
expectAsyncError] 
(tests/setup/test-setup.js:281:31)
      at Object.<anonymous> 
(tests/unit/admin.service.test.js:381:7)

Test Suites: 1 failed, 1 total
Tests:       12 failed, 5 passed, 17 total
Snapshots:   0 total
Time:        3.802 s, estimated 8 s
Ran all test suites matching 
/tests\\unit\\admin.service.test.js/i.
